#!/usr/bin/env python -W ignore::DeprecationWarning

import argparse
from sourcepredictlib.forest import sources


def _get_args():
    '''This function parses and return arguments passed in'''
    parser = argparse.ArgumentParser(
        prog='SourcePredict v' + str(version),
        formatter_class=argparse.RawDescriptionHelpFormatter,
        description='''
==================================================\n
SourcePredict\n
Author: Maxime Borry\n
Contact: <borry[at]shh.mpg.de>\n
Homepage & Documentation: github.com/maxibor/sourcepredict
==================================================
        ''')
    parser.add_argument('otu_table', help="path to otu table in csv format")
    parser.add_argument(
        '-o',
        dest="output",
        default=None,
        help="Output file basename. Default = <sample_basename>.sourcepredict.csv*")
    parser.add_argument(
        '-se',
        dest="seed",
        default=7357,
        help="Seed for random generator. Default = 7357")
    parser.add_argument(
        '-t',
        dest="threads",
        default=2,
        help="Number of threads for parallel processing. Default = 2")

    args = parser.parse_args()

    infile = args.otu_table
    seed = int(args.seed)
    threads = int(args.threads)

    return(infile, seed, threads)


if __name__ == "__main__":
    version = "0.1"
    INFILE, SEED, THREADS = _get_args()
    a = sources(INFILE)
    a.add_unknown(0.1)
    a.normalize()
    print(a.rndForest(seed=SEED, threads=THREADS))
